
<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
  <meta charset="UTF-8">
  <title>게시글 수정</title>
</head>
<body>

<h1>게시글 수정</h1>

<div>
  <!-- 게시글 수정 폼 -->
  <form th:action="@{/board/modify}" method="post" enctype="multipart/form-data">
    <!-- 게시글 번호는 hidden 필드로 전달 -->
    <input type="hidden" name="boardId" th:value="${boardDTO.boardId}"/>

    <table>
      <tr>
        <th>작성자</th>
        <td th:text="${boardDTO.username}">작성자 이름</td>
      </tr>
      <tr>
        <th>제목</th>
        <td><input type="text" name="title" th:value="${boardDTO.title}" required/></td>
      </tr>
      <tr>
        <th>내용</th>
        <td><textarea name="content" rows="5" required th:text="${boardDTO.content}">게시글 내용</textarea></td>
      </tr>
      <tr>
        <th>작성 날짜</th>
        <td th:text="${#temporals.format(boardDTO.regDate, 'yyyy-MM-dd HH:mm')}">2023-01-01 10:00</td>
      </tr>
      <tr>
        <th>수정 날짜</th>
        <td th:text="${#temporals.format(boardDTO.modDate, 'yyyy-MM-dd HH:mm')}">2023-01-01 10:00</td>
      </tr>
      <tr>
        <th>기존 파일</th>
        <td>
          <div>
            <ul>
              <!-- 기존에 업로드된 파일 목록을 보여줌 -->
              <li th:each="fileName : ${boardDTO.fileNames}">
                <span th:text="${fileName}">파일 이름</span>
                <!-- 파일 삭제 기능을 위한 버튼 -->
                <button type="button" onclick="removeFile(this, '[[${fileName}]]')">삭제</button>
              </li>
            </ul>
          </div>
        </td>
      </tr>
      <tr>
        <th>새로운 파일 추가</th>
        <td>
          <!-- 파일 업로드를 위한 멀티 파일 인풋 -->
          <input type="file" name="files" multiple />
        </td>
      </tr>
    </table>

    <div>
      <button type="submit">저장하기</button>
      <a th:href="@{/board/read(boardId=${boardDTO.boardId})}">취소</a>
      <a th:href="@{/board/remove(boardId=${boardDTO.boardId})}">삭제</a>
    </div>
  </form>
</div>

<script>
  function removeFile(button, fileName) {
    // 숨김 필드를 생성해 삭제할 파일 이름을 서버로 전송
    const form = button.closest("form");
    const input = document.createElement("input");
    input.type = "hidden";
    input.name = "deletedFiles";
    input.value = fileName;
    form.appendChild(input);

    // 삭제 버튼을 눌러 제거된 파일을 UI에서 삭제
    const li = button.closest("li");
    li.remove();
  }
</script>

</body>
</html>

